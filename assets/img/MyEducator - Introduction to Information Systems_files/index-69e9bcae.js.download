function e(){import.meta.url,import("_").catch((()=>1))}import{g as t,e as o,a as i,c as s,i as a,n as r,V as n,E as l,B as u,b as p,s as d,N as c,F as h,A as m,d as v,T as y,I as f,k as g,u as w,f as x,h as b,P as _,j as T,r as E,l as N,m as A,L as j,M as k,o as M,p as S}from"./app-lib-889fa967.js";import{t as P,f as D,k as C}from"./vendor-base-1656dc2a.js";import{R,j as V,g as L,F as O,B as I,i as B,P as z}from"./vendor-other-9db4b587.js";import"./vendor-xml-5b3ff65f.js";import"./vendor-intl-d36a140e.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const K=R.createContext({});function U(){return R.useContext(K).instance}K.displayName="NarrateContext",s(K,"_narrate_context_wrapper_",(e=>{e.ctxapp=e._narrate_context_wrapper_.instance}));const $="Ruth",H="en-US",F=".narrate-content",G=["*[data-narrate=select]","p","li","dd","th","td","h1","h2","h3","h4","h5","h6","title","caption"],q=["*[data-narrate=ignore]","script","style","iframe","frame","embed","object","canvas","audio","video","img","svg","math"];class X{constructor(e,t,o,i,s){this.block=e,this.idx=t,this.endidx=o,this.time=i,this.endtime=s,this.runs=[]}findTextRuns(e){let t=!1,o=-1,i=e.getCurrent();for(;i&&(this.idx>=i.idx&&this.idx<i.endidx&&(t=!0),t&&(o=i.idx-i.rel,this.runs.push(new W(i.parent,Math.max(i.rel,this.idx-o),Math.min(i.endrel,this.endidx-o)))),!(this.endidx>=i.idx&&this.endidx<=i.endidx));)i=e.getNext()}export(){return{idx:this.idx,endidx:this.endidx,time:this.time,endtime:this.endtime,runs:this.runs.map((e=>e.export()))}}}class W{constructor(e,t,o){this.parent=e,this.rel=t,this.endrel=o}export(){return{parent:this.parent?this.parent.nodeName.toLowerCase():null,rel:this.rel,endrel:this.endrel}}}const Y=/[ \t\n\r\f\v]+/g;class J{constructor(e,t,o,i){this.s1=e,this.s2=t,this.b1=o,this.b2=i}}class Z{constructor(e,t,o,i){this.s1=e,this.s2=t,this.b1=o,this.b2=i}}function*Q(e){const t=e.length;if(0===t)return;const o=new TextEncoder;let i,s,a=0,r=0,n=0;for(const l of e.matchAll(Y))i=l.index,s=i+l[0].length,a<i&&(n=r+o.encode(e.slice(a,i)).length,yield new J(a,i,r,n),r=n),n=r+o.encode(e.slice(i,s)).length,yield new Z(i,s,r,n),r=n,a=s;a<t&&(n=r+o.encode(e.slice(a,t)).length,yield new J(a,t,r,n))}function ee(e,t){if(e.nodeType===Node.ELEMENT_NODE&&t.length>0)for(const o of t)if(e.matches(o))return!0;return!1}function te(e){return P.blake2bHex(e,null,32)}function oe(e,t){let o=e[0],i=0,s=0,a=e.length;for(;i<a;)if(s=Math.floor((i+a)/2),o=e[s],t<o.time)a=s;else{if(!(t>=o.endtime))break;i=s+1}return t<o.time||t>=o.endtime?null:o}class ie{constructor(e,t,o){this.id=null,this.narration=e,this.elem=o,this.idx=0,this.endidx=-1,this.content=null,this.runs=[],this.words=[],this.time=-1,this.endtime=-1;let i=0,s=0;const r=[];let n,l=!0;const u=new TextEncoder,p=e=>{let t=0,o=0;for(const d of a(e))if(d.nodeType!==Node.ELEMENT_NODE||ee(d,this.narration.options.ignores)){if(d.nodeType===Node.TEXT_NODE){n=u.encode(d.nodeValue);for(const a of Q(d.nodeValue))a instanceof J?(r.push(...n.subarray(a.b1,a.b2)),s=i+a.b2-a.b1,l=!1):l||(r.push(32),s=i+1,l=!0),o=t+a.b2-a.b1,i<s&&this.runs.push(new se(i,s,e,t,o)),i=s,t=o}}else p(d)};p(o),this.content=new Uint8Array(r),this.id=D("b{:04d}-{}",t,te(this.content)),this.endidx=s}isEmpty(){return 0===this.endidx}wordForTimestamp(e){return oe(this.words,e)}integrateNarrationData(e){if(this.words.length>0)throw new Error("wordmarks were already added");this.time=e.ts,this.endtime=e.te;const t=new ae(this);for(const o of e.words){const e=new X(this,o.is,o.ie,o.ts,o.te);e.findTextRuns(t),this.words.push(e)}}export(){return{id:this.id,elem:this.elem?this.elem.nodeName.toLowerCase():null,idx:this.idx,endidx:this.endidx,content:Array.from(this.content),content_:(new TextDecoder).decode(this.content),runs:this.runs.map((e=>e.export())),words:this.words.map((e=>e.export())),time:this.time,endtime:this.endtime}}}class se{constructor(e,t,o,i,s){this.idx=e,this.endidx=t,this.parent=o,this.rel=i,this.endrel=s}export(){return{idx:this.idx,endidx:this.endidx,parent:this.parent?this.parent.nodeName.toLowerCase():null,rel:this.rel,endrel:this.endrel}}}class ae{constructor(e){this.block=e,this.idx=0}getCurrent(){return this.idx<this.block.runs.length?this.block.runs[this.idx]:null}getNext(){return this.idx+=1,this.getCurrent()}}class re{constructor(e){if(this.instanceId=r(),this.id=null,this.blocks=[],this.options={doc:window.document,root:F,selectors:G,ignores:q,voice_id:$,lang_code:H,...e},this.options.root.nodeName||(this.options.root=this.options.doc.querySelector(this.options.root)),!this.options.root)throw new n(`narration root not found: ${this.options.root}`);"string"===C(this.options.selectors)&&(this.options.selectors=[this.options.selectors]),"string"===C(this.options.ignores)&&(this.options.ignores=[this.options.ignores]);const t=e=>{if(ee(e,this.options.ignores));else if(ee(e,this.options.selectors)){const t=new ie(this,this.blocks.length,e);t.isEmpty()||this.blocks.push(t)}else for(const o of a(e,{type:Node.ELEMENT_NODE}))t(o)};t(this.options.root),this.id=te(this.blocks.map((e=>e.id)).join(""))}blockForTimestamp(e){return oe(this.blocks,e)}integrateNarrationData(e){for(const t of this.blocks){const o=e.blocks[t.id];o&&t.integrateNarrationData(o)}}to_ssml(){if(!this.blocks)throw new Error("blocks have not been found");const e=new TextDecoder,t=this.options.doc.implementation.createDocument(null,"speak",null),o=t.documentElement,i=l({document:t});o.appendChild(i("mark",{name:`id-${this.id}`}));for(const s of this.blocks)o.appendChild(i("p",i("mark",{name:s.id}),e.decode(s.content)));return o.appendChild(i("mark",{name:`end-${this.id}`})),t}export(){return{id:this.id,root:this.options.root?this.options.root.nodeName.toLowerCase():null,selectors:this.options.selectors,ignores:this.options.ignores,blocks:this.blocks.map((e=>e.export()))}}}class ne extends u{}ne.NAME="vapp-show-player";class le extends u{}le.NAME="vapp-hide-player";class ue extends u{_initialize(e,t){super._initialize(e,t),this.ssml=t.ssml}}ue.NAME="vapp-narration-processing";class pe extends u{}pe.NAME="vapp-player-ready";const de="narrate-styles",ce="narrate-highlight",he=`\n    <style id="${de}">\n        .${ce} {\n            background-color: #F8E3A3;\n            border-radius: 2px;\n        }\n    </style>\n`;function me(e){if(e)for(const t of e.querySelectorAll(`.${ce}`)){for(const e of a(t))t.parentNode.insertBefore(e,t);t.parentNode.removeChild(t)}}class ve extends Error{constructor(e,...t){super(e||"Speech processing failure",...t)}}class ye extends Error{constructor(e,...t){super(e||"Too many processing requests",...t)}}const fe=t("provider");class ge extends R.PureComponent{constructor(){super(...arguments),this.narration=null,this.error=null,this.voice=null,this.lang_code=null,this.playerReady=!1,this.state={counter:r()},this.togglePlayer=(e=void 0)=>{e=void 0===e?!this.playerVisible:e,this.props.webcomp.updateConfig({show:e})}}render(){return V.jsx(K.Provider,{value:{instance:this},children:this.props.children})}_setPlayerReady(e){fe.debug(e?"player ready":"player closed")(),this.playerReady=e,this.setState({counter:r()})}_setError(e){this.error=e,this.togglePlayer(!0)}get switchVisible(){return!this.props.webcomp.config.noswitch}get playerVisible(){return this.props.webcomp.config.show}resetNarration(){var e;me(null==(e=this.narration)?void 0:e.options.root),this.narration=null,this.error=null,this.setState({counter:r()})}async initNarration(){try{fe.debug("finding narration text")();const e=new re({root:this.props.webcomp.config.root||F,selectors:this.props.webcomp.config.selectors||G,ignores:this.props.webcomp.config.ignores||q,voice_id:this.props.webcomp.config.voice_id||$,lang_code:this.props.webcomp.config.lang_code||H});fe.debug(`found ${e.blocks.length} blocks`)(),this.setState({counter:r()}),fe.debug("downloading speech data")();const t=await this.downloadSpeech(e);if(!e)return;fe.debug("integrating word boundaries")(),e.integrateNarrationData(t),fe.debug("narration ready")(),this.narration=e,this.error=null,this.setState({counter:r()})}catch(e){fe.error(`Unable to initialize narration: ${e}`,e)(),this.narration=null,this._setError(e)}}async downloadSpeech(e,t=!0){var i;try{const t=await d({url:`${o.VOSHI_NARRATION_URL}/${e.id}.${e.options.lang_code}.${e.options.voice_id}.json`}).promise;if(null==(i=t.data.errors)?void 0:i.length){if(t.data.errors.flat().join(";").indexOf("ThrottlingException")>=0)throw new ye;throw new ve}return t.data}catch(n){if(!t)throw n;if(!(n instanceof c||n instanceof h||n instanceof ye))throw n}fe.debug("requesting audio processing")();const s=e.to_ssml(),a=(new XMLSerializer).serializeToString(s);ue.dispatch(this.props.webcomp,{ssml:a});const r=m.get().apiClient("narrate","v1");await r.post({path:"convert",data:{ssml:a,polly_config:{voice_id:e.options.voice_id,lang_code:e.options.lang_code},meta:{title:this.props.webcomp.config["meta-title"]||"",compilation:this.props.webcomp.config["meta-compilation"]||"",publisher:this.props.webcomp.config["meta-publisher"]||"",source:this.props.webcomp.config["meta-source"]||""},overwrite:!0}});for(let o=0;o<30;o++){if(await v(2e3),!e)return;try{return await this.downloadSpeech(e,!1)}catch(n){if(!(n instanceof c||n instanceof h||n instanceof ye))throw n}}throw Error("timed out")}}function we(e){const t=U(),o=L();return V.jsx(V.Fragment,{children:V.jsx("div",{className:"app-toggle",children:V.jsx(O.Check,{type:"switch",label:o.formatMessage({id:"4zpjnr73Lb_i",defaultMessage:[{type:0,value:"Narration:"}]}),checked:t.playerVisible,onChange:e=>{t.togglePlayer(e.target.checked)},title:o.formatMessage({id:"dod6PSv-4s2_",defaultMessage:[{type:0,value:"Click to show/hide the narration player"}]})})})})}class xe extends R.Component{constructor(e){super(e),this.updateHighlight=()=>{var e;if(!this.props.narration||!this.props.audio)return;const t=Math.floor(1e3*(this.props.audio.currentTime||0));0===t?(this.block=null,this.word=null,me(this.props.narration.options.root)):((!this.block||t<this.block.time||t>=this.block.endtime)&&(this.block=this.props.narration.blockForTimestamp(t),this.word=null),(!this.word||t<this.word.time||t>=this.word.endtime)&&(this.word=(null==(e=this.block)?void 0:e.wordForTimestamp(t))||null,me(this.props.narration.options.root),this.word&&function(e){const t=new TextEncoder,o=new TextDecoder;for(let i=e.runs.length-1;i>=0;i--){const s=e.runs[i];s.parent.normalize();let r=0,n=0,l="";for(const e of a(s.parent,{type:Node.TEXT_NODE})){const i=t.encode(e.nodeValue);if(n=r+i.length,s.rel>=r&&s.endrel<=n){s.rel>r&&(l=o.decode(i.slice(0,s.rel-r)),s.parent.insertBefore(p("#text",l),e)),l=o.decode(i.slice(s.rel-r,s.endrel-r)),s.parent.insertBefore(p("span",{class:ce},l),e),s.endrel<n?(l=o.decode(i.slice(s.endrel-r,n)),e.nodeValue=l):e.nodeValue="";break}r=n}}}(this.word)))},this.block=null,this.word=null,this.timer=new y({onTimer:this.updateHighlight,delay:50,repeating:!0})}render(){return null}componentDidUpdate(){!this.timer.running&&this.props.playing?this.timer.start():this.timer.running&&!this.props.playing&&this.timer.cancel(),this.timer.running||this.updateHighlight()}componentWillUnmount(){var e;this.timer.cancel(),me(null==(e=this.props.narration)?void 0:e.options.root)}}function be({ctxapp:e,player:t,audio:o,controls:i,...s}){const a=L();return V.jsx(I,{ref:i.boundRefs.playBtn,variant:"link",disabled:0===i.props.duration,className:"audio-play-control",onClick:e=>{t.togglePlaying()},title:a.formatMessage({id:"Uh5L4WQrALv6",defaultMessage:[{type:0,value:"Play/pause narration audio"}]}),children:V.jsx(f,{icon:t.playing?"faPause":"faPlay",weight:"solid"})})}function _e({ctxapp:e,player:t,audio:o,controls:i,...s}){const a=L(),r=R.useMemo((()=>g({onKeyDown_ArrowLeft:e=>{e.defaultPrevented||(e.preventDefault(),t.setTime("down"))},onKeyDown_ArrowRight:e=>{e.defaultPrevented||(e.preventDefault(),t.setTime("up"))},onKeyDown_Enter:e=>{e.defaultPrevented||(e.preventDefault(),t.togglePlaying())},"onKeyDown_ ":e=>{e.defaultPrevented||(e.preventDefault(),t.togglePlaying())}})),[]);return V.jsx("input",{ref:i.boundRefs.timeSlider,className:"audio-slider-control",title:a.formatMessage({id:"RYCP3lphxydi",defaultMessage:[{type:0,value:"Adjust audio position"}]}),type:"range",value:t.time,min:0,max:t.duration,disabled:0===t.duration,onChange:e=>{t.setTime(e.target.value)},onKeyDown:r})}const Te="vapp-narrate-controls",Ee=100,Ne=10,Ae=100,je=[{value:50,label:"0.5",text:"0.5"},{value:75,label:"•",text:"0.75"},{value:100,label:"1.0",text:"1.0"},{value:125,label:"•",text:"1.25"},{value:150,label:"1.5",text:"1.5"},{value:175,label:"•",text:"1.75"},{value:200,label:"2.0",text:"2.0"}];function ke(e){for(let t=0;t<je.length;t++)if(e<=je[t].value)return t;return je.length-1}function Me(e){let t=e/Ee;const o=Math.floor(t/60);return t=Math.floor(t)-60*o,`${o}:`+`0${t}`.slice(-2)}function Se({ctxapp:e,player:t,audio:o,controls:i,...s}){const a=L(),r=w(),n=x(),l=t.rateIndex,u=R.useMemo((()=>g({onKeyDown_ArrowDown:e=>{e.defaultPrevented||(e.preventDefault(),t.setRate("down"))},onKeyDown_ArrowUp:e=>{e.defaultPrevented||(e.preventDefault(),t.setRate("up"))},onKeyDown_Enter:e=>{e.defaultPrevented||(e.preventDefault(),i.rateBtn.focus())},onKeyDown_Escape:e=>{e.defaultPrevented||(e.preventDefault(),i.rateBtn.focus())}})),[]);return V.jsxs(V.Fragment,{children:[V.jsx(I,{ref:i.boundRefs.rateBtn,variant:"link",className:"audio-rate-control audio-rate-area flex-minimal",title:a.formatMessage({id:"vwGlrYboPYu1",defaultMessage:[{type:0,value:"Adjust audio rate"}]}),onClick:n.toggle,onFocus:e=>{n.value||window.setTimeout((()=>{n.toggle(!0)}),100)},onBlur:e=>{n.value&&window.setTimeout((()=>{b(r.docRoot.activeElement,"audio-rate-area")||n.toggle(!1)}),100)},onKeyDown:u,children:je[l].text}),V.jsx(_,{show:n.value,setShow:n.toggle,noAutoHide:!0,groupKey:"narrate-controls-popup",target:i.rateBtn,placement:"top",strategy:"fixed",modifiers:[{name:"offset",options:{offset:[0,16]}}],children:e=>{const o=t.rate;return V.jsx("div",{className:"audio-rate-container audio-rate-area",onBlur:e=>{window.setTimeout((()=>{b(r.docRoot.activeElement,"audio-rate-area")||n.toggle(!1)}),100)},children:V.jsx(B,{vertical:!0,children:je.map((e=>V.jsx(I,{variant:"link",active:e.value===o,onClick:o=>{t.setRate(e.value)},onKeyDown:u,children:e.label},e.text)))})})}})]})}function Pe({ctxapp:e,player:t,audio:o,controls:i,...s}){return V.jsxs("div",{className:"audio-time-control",children:[V.jsx("span",{"aria-label":"Audio Position",role:"timer",children:Me(t.time||0)}),V.jsx("span",{className:"time-slash",children:" / "}),V.jsx("span",{"aria-label":"Audio Duration",children:Me(t.duration||0)})]})}function De({ctxapp:e,player:t,audio:o,controls:i,...s}){const a=L(),r=w(),n=x(),l=R.useMemo((()=>g({onKeyDown_ArrowUp:e=>{e.defaultPrevented||(e.preventDefault(),t.setVolume("up"))},onKeyDown_ArrowDown:e=>{e.defaultPrevented||(e.preventDefault(),t.setVolume("down"))},onKeyDown_Enter:e=>{e.defaultPrevented||(e.preventDefault(),i.volumeBtn.focus())},onKeyDown_Escape:e=>{e.defaultPrevented||(e.preventDefault(),i.volumeBtn.focus())}})),[]),u=t.volume,p=t.muted;return V.jsxs(V.Fragment,{children:[V.jsx(I,{ref:i.boundRefs.volumeBtn,variant:"link",className:"audio-volume-control audio-volume-area flex-minimal",title:a.formatMessage({id:"nEmyypBigwoj",defaultMessage:[{type:0,value:"Narration audio volume"}]}),onClick:e=>{n.value&&t.toggleMuted()},onFocus:e=>{n.value||window.setTimeout((()=>{n.toggle(!0)}),100)},onBlur:e=>{n.value&&window.setTimeout((()=>{b(r.docRoot.activeElement,"audio-volume-area")||n.toggle(!1)}),100)},onKeyDown:l,children:V.jsx(f,{icon:p?"faVolumeMute":u>7?"faVolumeUp":u>3?"faVolume":u>0?"faVolumeDown":"faVolumeOff",weight:"solid"})}),V.jsx(_,{show:n.value,setShow:n.toggle,groupKey:"narrate-controls-popup",noAutoHide:!0,target:i.volumeBtn,placement:"top",strategy:"fixed",modifiers:[{name:"offset",options:{offset:[0,14]}}],children:e=>{const o=t.volume,i=t.muted;return V.jsx("div",{className:"audio-volume-container audio-volume-area",children:V.jsx("input",{className:"flex-maximal",type:"range",orient:"vertical",value:i?0:o,min:0,max:Ne,onChange:e=>{t.setVolume(e.target.value)},onBlur:e=>{window.setTimeout((()=>{b(r.docRoot.activeElement,"audio-volume-area")||n.toggle(!1)}),100)},onKeyDown:l})})}})]})}class Ce extends R.Component{constructor(){super(...arguments),this.playBtn=T(this,"playBtn"),this.volumeBtn=T(this,"volumeBtn"),this.rateBtn=T(this,"rateBtn"),this.timeSlider=T(this,"timeSlider"),this.timer=new y({onTimer:this.props.player.refresh,delay:250,repeating:!0})}componentDidMount(){this.timer.start(),this.props.ctxapp._setPlayerReady(!0),this.props.player.refresh(),pe.dispatch(this.props.webcomp),window.setTimeout((()=>{var e;null==(e=this.playBtn)||e.focus()}),100)}componentDidUpdate(){!this.timer.running&&this.props.player.playing?this.timer.start():this.timer.running&&!this.props.player.playing&&this.timer.cancel()}componentWillUnmount(){this.props.audio.pause(),this.timer.cancel(),this.props.ctxapp._setPlayerReady(!1)}render(){return V.jsxs("div",{className:"audio-controls","data-playing":this.props.player.playing?"1":"0",children:[V.jsx("div",{className:"audio-controls-item flex-minimal",children:V.jsx(be,{ctxapp:this.props.ctxapp,player:this.props.player,audio:this.props.audio,controls:this})}),V.jsx("div",{className:"audio-controls-item flex-minimal ps-1",children:V.jsx(Pe,{ctxapp:this.props.ctxapp,player:this.props.player,audio:this.props.audio,controls:this})}),V.jsx("div",{className:"audio-controls-item flex-maximal ps-1",children:V.jsx(_e,{ctxapp:this.props.ctxapp,player:this.props.player,audio:this.props.audio,controls:this})}),V.jsx("div",{className:"audio-controls-item flex-minimal ps-1",children:V.jsx(De,{ctxapp:this.props.ctxapp,player:this.props.player,audio:this.props.audio,controls:this})}),V.jsx("div",{className:"audio-controls-item flex-minimal ps-1",children:V.jsx(Se,{ctxapp:this.props.ctxapp,player:this.props.player,audio:this.props.audio,controls:this})})]})}}const Re=t("player");class Ve extends R.Component{constructor(){super(...arguments),this.audio=T(this,"audio"),this.controls=T(this,"controls"),this.state={counter:0},this.refresh=()=>new Promise((e=>{this.setState({counter:r()},e)})),this.togglePlaying=(e=void 0)=>{(e=void 0===e?!this.playing:e)?this.audio.play():this.audio.pause(),this.refresh()},this.setTime=e=>{"up"===e?e=this.time+500:"down"===e&&(e=this.time-500),e=Math.min(this.duration,Math.max(0,e||0)),this.audio.currentTime=e/Ee,this.refresh()},this.toggleMuted=(e=void 0)=>{e=void 0===e?!this.audio.muted:e,this.audio.muted=e,this.saveSettings(),this.refresh()},this.setVolume=e=>{"up"===e?e=this.audio.volume*Ne+1:"down"===e&&(e=this.audio.volume*Ne-1),e=Math.min(Ne,Math.max(0,e||0)),this.audio.volume=E(e/Ne,1),this.audio.muted=!1,this.saveSettings(),this.refresh()},this.setRate=e=>{let t;t="up"===e?this.rateIndex+1:"down"===e?this.rateIndex-1:ke(e),t=Math.min(je.length-1,Math.max(0,t)),this.audio.playbackRate=je[t].value/Ae,this.saveSettings(),this.refresh()},this.restoreSettings=()=>{let e={};try{e=JSON.parse(window.localStorage.getItem(Te))||e}catch(t){Re.info("unable to parse player settings: {}",t.toString())()}this.toggleMuted(e.muted||!1),this.setVolume(e.hasOwnProperty("volume")?e.volume:Ne),this.setRate(e.hasOwnProperty("rate")?e.rate:Ae)},this.saveSettings=()=>{try{window.localStorage.setItem(Te,JSON.stringify({muted:this.muted,volume:this.volume,rate:this.rate}))}catch(e){Re.info("unable to save player settings: {}",e.toString())()}}}componentDidMount(){this.restoreSettings(),this.props.ctxapp.resetNarration(),this.props.ctxapp.initNarration(),ne.dispatch(this.props.webcomp)}componentWillUnmount(){this.saveSettings(),this.props.ctxapp.resetNarration(),le.dispatch(this.props.webcomp)}render(){var e;return V.jsxs("div",{className:"audio-player",role:"dialog","aria-modal":"false","aria-label":"Narration Audio Player",children:[this.props.ctxapp.error?V.jsxs("div",{className:"flex-maximal ps-1",children:["Error: ",N(this.props.ctxapp.error)]}):this.props.ctxapp.narration&&this.audio&&this.duration?V.jsx(Ce,{ref:this.boundRefs.controls,ctxapp:this.props.ctxapp,webcomp:this.props.webcomp,audio:this.audio,player:this}):V.jsx("div",{className:"flex-maximal ps-1",children:V.jsx(z,{className:"audio-loading-progress flex-maximal",animated:!0,now:100})}),V.jsx("div",{className:"flex-minimal ps-0p5",children:V.jsx(I,{variant:"link",className:"audio-player-close p-0p5","aria-label":"Close narrate tool",onClick:e=>{this.props.ctxapp.togglePlayer(!1)},children:V.jsx(f,{icon:"faTimes",className:"fs-1"})})}),V.jsx(xe,{narration:this.props.ctxapp.narration,audio:this.audio,playing:!(!this.audio||this.audio.paused)}),V.jsx("audio",{ref:this.boundRefs.audio,onPlay:this.refresh,onPause:this.refresh,onEnded:this.refresh,onVolumeChange:this.refresh,onRateChange:this.refresh,onDurationChange:this.refresh,children:(null==(e=this.props.ctxapp.narration)?void 0:e.id)&&V.jsx("source",{src:`${o.VOSHI_NARRATION_URL}/${this.props.ctxapp.narration.id}.${this.props.ctxapp.narration.options.lang_code}.${this.props.ctxapp.narration.options.voice_id}.mp3`,type:"audio/mpeg"})})]})}get playing(){var e;return!(null==(e=this.audio)?void 0:e.paused)}get time(){var e;return((null==(e=this.audio)?void 0:e.currentTime)||0)*Ee}get duration(){var e;return((null==(e=this.audio)?void 0:e.duration)||0)*Ee}get volume(){var e;return((null==(e=this.audio)?void 0:e.volume)||0)*Ne}get muted(){var e;return null==(e=this.audio)?void 0:e.muted}get rate(){var e;return((null==(e=this.audio)?void 0:e.playbackRate)||0)*Ae}get rateIndex(){var e;return ke(((null==(e=this.audio)?void 0:e.playbackRate)||0)*Ae)}}function Le(e){const t=w(),o=U();return V.jsxs(V.Fragment,{children:[o.switchVisible&&V.jsx(we,{ctxapp:o,webcomp:t}),o.playerVisible&&V.jsx(Ve,{ctxapp:o,webcomp:t})]})}const Oe={en:{FnfezUqXGjMI:[{type:0,value:"across the "},{type:1,value:"subs"},{type:0,value:" most recent "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:"."}],Vn6sjvEwHkZK:[{type:1,value:"count"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"record"}]},other:{value:[{type:0,value:"records"}]}},pluralType:"cardinal",type:6,value:"count"},{type:0,value:"."}],Vrh8f2BVOLwy:[{type:0,value:"Search"}],"admin.pages.search.form.placeholder":[{type:0,value:"Search"}],c_3Gzhj7KLHI:[{type:1,value:"subs"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:" allowed."}],"epoch.duration.days":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"day"}]},other:{value:[{type:0,value:"days"}]},two:{value:[{type:0,value:"days"}]},zero:{value:[{type:0,value:"days"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.hours":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"hour"}]},other:{value:[{type:0,value:"hours"}]},two:{value:[{type:0,value:"hours"}]},zero:{value:[{type:0,value:"hours"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.millis":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"millisecond"}]},other:{value:[{type:0,value:"milliseconds"}]},two:{value:[{type:0,value:"milliseconds"}]},zero:{value:[{type:0,value:"milliseconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.minutes":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"minute"}]},other:{value:[{type:0,value:"minutes"}]},two:{value:[{type:0,value:"minutes"}]},zero:{value:[{type:0,value:"minutes"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.seconds":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"second"}]},other:{value:[{type:0,value:"seconds"}]},two:{value:[{type:0,value:"seconds"}]},zero:{value:[{type:0,value:"seconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.weeks":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"week"}]},other:{value:[{type:0,value:"weeks"}]},two:{value:[{type:0,value:"weeks"}]},zero:{value:[{type:0,value:"weeks"}]}},pluralType:"cardinal",type:6,value:"num"}],fkUMsTGn8rzM:[{type:0,value:"asdfasdf"}],"reader.pages.index.noauth":[{type:0,value:"Not authenticated: please launch from your LMS."}]},es:{FnfezUqXGjMI:[{type:0,value:"across the "},{type:1,value:"subs"},{type:0,value:" most recent "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:"."}],Vn6sjvEwHkZK:[{type:1,value:"count"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"record"}]},other:{value:[{type:0,value:"records"}]}},pluralType:"cardinal",type:6,value:"count"},{type:0,value:"."}],Vrh8f2BVOLwy:[{type:0,value:"Search"}],"admin.pages.search.form.placeholder":[{type:0,value:"Search"}],c_3Gzhj7KLHI:[{type:1,value:"subs"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"attempt"}]},other:{value:[{type:0,value:"attempts"}]}},pluralType:"cardinal",type:6,value:"subs"},{type:0,value:" allowed."}],"epoch.duration.days":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"day"}]},other:{value:[{type:0,value:"days"}]},two:{value:[{type:0,value:"days"}]},zero:{value:[{type:0,value:"days"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.hours":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"hour"}]},other:{value:[{type:0,value:"hours"}]},two:{value:[{type:0,value:"hours"}]},zero:{value:[{type:0,value:"hours"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.millis":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"millisecond"}]},other:{value:[{type:0,value:"milliseconds"}]},two:{value:[{type:0,value:"milliseconds"}]},zero:{value:[{type:0,value:"milliseconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.minutes":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"minute"}]},other:{value:[{type:0,value:"minutes"}]},two:{value:[{type:0,value:"minutes"}]},zero:{value:[{type:0,value:"minutes"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.seconds":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"second"}]},other:{value:[{type:0,value:"seconds"}]},two:{value:[{type:0,value:"seconds"}]},zero:{value:[{type:0,value:"seconds"}]}},pluralType:"cardinal",type:6,value:"num"}],"epoch.duration.weeks":[{type:1,value:"num"},{type:0,value:" "},{offset:0,options:{one:{value:[{type:0,value:"week"}]},other:{value:[{type:0,value:"weeks"}]},two:{value:[{type:0,value:"weeks"}]},zero:{value:[{type:0,value:"weeks"}]}},pluralType:"cardinal",type:6,value:"num"}],fkUMsTGn8rzM:[{type:0,value:"Not authenticated: please launch from your LMS."}],"reader.pages.index.noauth":[{type:0,value:"Not authenticated: please launch from your LMS."}]}};D.setOptions({strict:!1});const Ie=t("app");class Be extends A{constructor(){super(...arguments),this.provider=null,this._setAppProvider=e=>{this.provider=e}}connectedCallback(){if(super.connectedCallback(),!document.getElementById(`#${de}`)){const e=document.createElement("div");e.innerHTML=he.trim(),document.head.appendChild(e.firstChild)}this.isStandalone&&async function(){try{const e=await d({url:`${o.VOSHI_STATIC_URL}/narrate/lily.html`}).promise,t=(new DOMParser).parseFromString(e.body,"text/html");for(const o of a(t.body))document.body.appendChild(o);const i=document.querySelector("vapp-narrate");i.setAttribute("lang_code","en-US"),i.setAttribute("voice_id","Ruth"),document.querySelector("vapp-narrate").addEventListener("vapp-ready",(e=>{e.isReady&&e.webcomp.provider.togglePlayer(!0)}))}catch(e){Ie.error("unable to inject testing content: {}",e)()}}()}_getConfigAttrs(){return{...super._getConfigAttrs(),show:M(this,"show"),noswitch:M(this,"noswitch"),root:this.getAttribute("root")||void 0,selectors:this.getAttribute("selectors")||void 0,ignores:this.getAttribute("ignores")||void 0,voice_id:this.getAttribute("voice_id")||void 0,lang_code:this.getAttribute("lang_code")||void 0,"meta-title":this.getAttribute("meta-title")||void 0,"meta-compilation":this.getAttribute("meta-compilation")||void 0,"meta-publisher":this.getAttribute("meta-publisher")||void 0,"meta-source":this.getAttribute("meta-source")||void 0}}_syncConfigAttrs(){super._syncConfigAttrs(),S(this,"show",this.config.show),S(this,"noswitch",this.config.noswitch),this.hasAttribute("root")&&this.setAttribute("root",this.config.root||""),this.hasAttribute("selectors")&&this.setAttribute("selectors",this.config.selectors||""),this.hasAttribute("ignores")&&this.setAttribute("ignores",this.config.ignores||""),this.hasAttribute("voice_id")&&this.setAttribute("voice_id",this.config.voice_id||""),this.hasAttribute("lang_code")&&this.setAttribute("lang_code",this.config.lang_code||""),this.hasAttribute("meta-title")&&this.setAttribute("meta-title",this.config["meta-title"]||""),this.hasAttribute("meta-compilation")&&this.setAttribute("meta-compilation",this.config["meta-compilation"]||""),this.hasAttribute("meta-publisher")&&this.setAttribute("meta-publisher",this.config["meta-publisher"]||""),this.hasAttribute("meta-source")&&this.setAttribute("meta-source",this.config["meta-source"]||"")}}Be.ELEMENT_NAME="NarrateElement",Be.ELEMENT_TAG=`vapp-${o.VOSHI_APP}`,Be.CONFIG={...A.CONFIG,root:void 0,selectors:void 0,ignores:void 0,noswitch:void 0,show:void 0,voice_id:void 0,lang_code:void 0,"meta-title":void 0,"meta-compilation":void 0,"meta-publisher":void 0,"meta-source":void 0},Be.ATTRIBUTES={...A.ATTRIBUTES,root:void 0,selectors:void 0,ignores:void 0,noswitch:void 0,show:void 0,voice_id:void 0,lang_code:void 0,"meta-title":void 0,"meta-compilation":void 0,"meta-publisher":void 0,"meta-source":void 0},Be.REACT_COMPONENT=function({webcomp:e,...t}){return V.jsx(j,{messages:Oe,children:V.jsx(k,{children:V.jsx(ge,{ref:e._setAppProvider,webcomp:e,children:V.jsx(Le,{})})})})},function(e){const s=t("voshi");try{if(!o.VOSHI_APP)throw new Error("environment is missing VOSHI_APP");if(!o.VOSHI_STAGE)throw new Error("environment is missing VOSHI_STAGE");if(!o.VOSHI_BUILD)throw new Error("environment is missing VOSHI_BUILD");if(!o.VOSHI_PLATFORM)throw new Error("environment is missing VOSHI_PLATFORM");s.force("welcome to {}",o.appsig)(),o.appsig!==i.appsig&&s.force("built as {}",i.appsig)(),window.customElements.get(e.ELEMENT_TAG)?s.info(`custom element already defined for <${e.ELEMENT_TAG}>`)():(s.info(`defining custom element ${e.ELEMENT_NAME} for <${e.ELEMENT_TAG}>`)(),window.customElements.define(e.ELEMENT_TAG,e))}catch(a){s.error("Error loading app",a)()}}(Be);export{e as __vite_legacy_guard};
